var b=Object.defineProperty;var m=(e,r,o)=>r in e?b(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o;var S=(e,r,o)=>(m(e,typeof r!="symbol"?r+"":r,o),o);import{aJ as V,aK as j,aI as A,G as R,aL as h,aH as L,aC as q,y as P,aG as k,aF as v,u as s,B as w,D as g,Z as D,P as K,$,a1 as J,a3 as x,a5 as z,a7 as Z,a9 as X,ab as EE,af as eE,ah as rE,V as B,ad as aE,F as H,J as oE,O as tE,al as _E,Q as sE,az as RE,s as F,l as lE,aM as u}from"./storage-WeEp-Umj.js";const Q=navigator.userAgent.includes("Win"),TE=()=>new Promise(e=>chrome.windows.getLastFocused(e)),iE=e=>e?"?"+Object.entries(e).map(([r,o])=>[r,o].map(encodeURIComponent).join("=")).join("&"):"",pE=async({payload:e,sender:r,parameter:o,requestMessage:a,receivingMessage:I,errorPayload:n,width:E=Q?A+h:A,height:t=Q?L+h:L})=>{var U,G;try{const N=await chrome.windows.getAll(),{currentWindowId:d}=await chrome.storage.local.get(V);if(d&&N.find(i=>i.id===d))chrome.windows.update(d,{focused:!0});else{const i=await TE(),Y=await chrome.windows.create({url:`../..${j}${iE({...e,id:(U=r.tab)==null?void 0:U.id,requestMessage:a})}&${o}`,type:"popup",width:E,height:t,left:i!=null&&i.left&&(i!=null&&i.width)?i.left+(i.width-A):void 0,top:i==null?void 0:i.top});chrome.storage.local.set({currentWindowId:Y.id})}}catch(N){console.error(N),chrome.tabs.sendMessage(((G=r.tab)==null?void 0:G.id)||0,{app:R,type:I,payload:n})}};async function W(){await chrome.offscreen.createDocument({url:"offscreen.html",reasons:[chrome.offscreen.Reason.BLOBS],justification:"keep service worker running"}).catch(()=>{})}function nE(){chrome.offscreen.closeDocument().catch(()=>{})}const l={result:null},IE=e=>{if(e==="RECEIVE_SEND_PAYMENT/V3"||e==="RECEIVE_PAYMENT_HASH")return{app:R,type:e,payload:e==="RECEIVE_SEND_PAYMENT/V3"?l:{hash:null}};if(e==="RECEIVE_GET_ADDRESS/V3"||e==="RECEIVE_ADDRESS")return{app:R,type:e,payload:e==="RECEIVE_GET_ADDRESS/V3"?l:{publicAddress:null}};if(e==="RECEIVE_GET_PUBLIC_KEY/V3"||e==="RECEIVE_PUBLIC_KEY")return{app:R,type:e,payload:e==="RECEIVE_GET_PUBLIC_KEY/V3"?l:{address:null,publicKey:null}};if(e==="RECEIVE_SIGN_ALICES_RING/V3")return{app:R,type:"RECEIVE_SIGN_ALICES_RING/V3",payload:l};if(e==="RECEIVE_SIGN_MESSAGE/V3"||e==="RECEIVE_SIGN_MESSAGE")return{app:R,type:e,payload:e==="RECEIVE_SIGN_MESSAGE/V3"?l:{signedMessage:null}};if(e==="RECEIVE_SUBMIT_TRANSACTION/V3")return{app:R,type:"RECEIVE_SUBMIT_TRANSACTION/V3",payload:l};if(e==="RECEIVE_SIGN_TRANSACTION/V3")return{app:R,type:"RECEIVE_SIGN_TRANSACTION/V3",payload:l};if(e==="RECEIVE_SUBMIT_BULK_TRANSACTIONS/V3")return{app:R,type:"RECEIVE_SUBMIT_BULK_TRANSACTIONS/V3",payload:l};if(e==="RECEIVE_SET_TRUSTLINE/V3"||e==="RECEIVE_TRUSTLINE_HASH")return{app:R,type:e,payload:e==="RECEIVE_SET_TRUSTLINE/V3"?l:{hash:null}};if(e==="RECEIVE_GET_NFT/V3"||e==="RECEIVE_NFT")return{app:R,type:e,payload:e==="RECEIVE_GET_NFT/V3"?l:{nfts:null}};if(e==="RECEIVE_MINT_NFT/V3")return{app:R,type:"RECEIVE_MINT_NFT/V3",payload:l};if(e==="RECEIVE_CREATE_NFT_OFFER/V3")return{app:R,type:"RECEIVE_CREATE_NFT_OFFER/V3",payload:l};if(e==="RECEIVE_CANCEL_NFT_OFFER/V3")return{app:R,type:"RECEIVE_CANCEL_NFT_OFFER/V3",payload:l};if(e==="RECEIVE_ACCEPT_NFT_OFFER/V3")return{app:R,type:"RECEIVE_ACCEPT_NFT_OFFER/V3",payload:l};if(e==="RECEIVE_BURN_NFT/V3")return{app:R,type:"RECEIVE_BURN_NFT/V3",payload:l};if(e==="RECEIVE_SET_ACCOUNT/V3")return{app:R,type:"RECEIVE_SET_ACCOUNT/V3",payload:l};if(e==="RECEIVE_CREATE_OFFER/V3")return{app:R,type:"RECEIVE_CREATE_OFFER/V3",payload:l};if(e==="RECEIVE_CANCEL_OFFER/V3")return{app:R,type:"RECEIVE_CANCEL_OFFER/V3",payload:l};if(e==="RECEIVE_SET_REGULAR_KEY/V3")return{app:R,type:"RECEIVE_SET_REGULAR_KEY/V3",payload:l};if(e==="RECEIVE_SET_HOOK/V3")return{app:R,type:"RECEIVE_SET_HOOK/V3",payload:l}},cE=30,CE=60*1e3,c=class c{constructor(){S(this,"password",null);S(this,"timeoutId",null)}static getInstance(){return c.instance||(c.instance=new c),c.instance}isSessionActive(){return this.timeoutId!==null}startSession(r){this.endSession(!0),this.password=r,W(),this.timeoutId=setTimeout(()=>{this.endSession()},cE*CE)}endSession(r){this.password=null,this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null,nE()),r||NE({app:R,type:"EVENT_LOGOUT",source:"GEM_WALLET_MSG_REQUEST",payload:{id:0,result:{loggedIn:!1}}})}getPassword(){return this.isSessionActive()||this.endSession(!0),this.password}};S(c,"instance",null);let M=c;const SE=(e,r)=>{chrome.tabs.sendMessage(e??0,r)};chrome.runtime.onStartup.addListener(W);chrome.runtime.onMessage.addListener(()=>{});const y=M.getInstance();let O;const T=({payload:e,parameter:r,receivingMessage:o,sender:a,errorPayload:I,requestMessage:n})=>{const E=RE();F(E,JSON.stringify(e)).then(()=>p({payload:{storageKey:E},sender:a,parameter:r,receivingMessage:o,requestMessage:n,errorPayload:I??{type:s.Reject,result:void 0}}))},p=async e=>{const{currentWindowId:r}=await chrome.storage.local.get(V),o=await chrome.windows.getAll(),a=r&&o.find(n=>n.id===r);if(await lE(u)&&a)return Promise.resolve();a&&(await chrome.storage.local.remove(V),await chrome.windows.remove(r)),O=e.receivingMessage,F(u,!0),pE(e)},_=(e,r)=>{F(u,!1),SE(e,r)};chrome.runtime.onMessage.addListener((e,r)=>{var I,n;const{app:o,type:a}=e;if(!(o!==R||r.id!==chrome.runtime.id)){if(a===q)y.endSession();else if(a===P&&e.payload.password)y.startSession(e.payload.password);else if(a===k)chrome.runtime.sendMessage(chrome.runtime.id,{app:R,type:P,payload:{password:y.getPassword()}});else if(a==="REQUEST_GET_NETWORK/V3")p({payload:{id:(I=r.tab)==null?void 0:I.id},sender:r,parameter:v,requestMessage:e.type,receivingMessage:"RECEIVE_GET_NETWORK/V3",errorPayload:{type:s.Reject,result:void 0},width:1,height:1});else if(a==="REQUEST_NETWORK")p({payload:{id:(n=r.tab)==null?void 0:n.id},sender:r,parameter:v,receivingMessage:"RECEIVE_NETWORK",errorPayload:{network:void 0},width:1,height:1});else if(a==="REQUEST_GET_ADDRESS/V3")p({payload:e.payload,sender:r,parameter:w,requestMessage:e.type,receivingMessage:"RECEIVE_GET_ADDRESS/V3",errorPayload:{type:s.Reject,result:void 0}});else if(a==="REQUEST_ADDRESS")p({payload:e.payload,sender:r,parameter:w,receivingMessage:"RECEIVE_ADDRESS",errorPayload:{publicAddress:void 0}});else if(a==="REQUEST_GET_PUBLIC_KEY/V3")p({payload:e.payload,sender:r,parameter:g,requestMessage:e.type,receivingMessage:"RECEIVE_GET_PUBLIC_KEY/V3",errorPayload:{type:s.Reject,result:void 0}});else if(a==="REQUEST_PUBLIC_KEY")p({payload:e.payload,sender:r,parameter:g,receivingMessage:"RECEIVE_PUBLIC_KEY",errorPayload:{address:void 0,publicKey:void 0}});else if(a==="REQUEST_GET_NFT/V3")p({payload:e.payload,sender:r,parameter:D,requestMessage:e.type,receivingMessage:"RECEIVE_GET_NFT/V3",errorPayload:{type:s.Reject,result:void 0}});else if(a==="REQUEST_NFT")p({payload:e.payload,sender:r,parameter:D,receivingMessage:"RECEIVE_NFT",errorPayload:{nfts:void 0}});else if(a==="REQUEST_SEND_PAYMENT/V3"){const{payload:E}=e;try{T({payload:E,parameter:K,receivingMessage:"RECEIVE_SEND_PAYMENT/V3",requestMessage:e.type,sender:r})}catch(t){console.error(t)}}else if(a==="SEND_PAYMENT"){const{payload:E}=e;try{T({payload:E,parameter:K,receivingMessage:"RECEIVE_PAYMENT_HASH",requestMessage:e.type,sender:r,errorPayload:{hash:void 0}})}catch(t){console.error(t)}}else if(a==="REQUEST_MINT_NFT/V3"){const{payload:E}=e;try{T({payload:E,parameter:$,receivingMessage:"RECEIVE_MINT_NFT/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_CREATE_NFT_OFFER/V3"){const{payload:E}=e;try{T({payload:E,parameter:J,receivingMessage:"RECEIVE_CREATE_NFT_OFFER/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_CANCEL_NFT_OFFER/V3"){const{payload:E}=e;try{T({payload:E,parameter:x,receivingMessage:"RECEIVE_CANCEL_NFT_OFFER/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_ACCEPT_NFT_OFFER/V3"){const{payload:E}=e;try{T({payload:E,parameter:z,receivingMessage:"RECEIVE_ACCEPT_NFT_OFFER/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_BURN_NFT/V3"){const{payload:E}=e;try{T({payload:E,parameter:Z,receivingMessage:"RECEIVE_BURN_NFT/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SET_ACCOUNT/V3"){const{payload:E}=e;try{T({payload:E,parameter:X,receivingMessage:"RECEIVE_SET_ACCOUNT/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SET_REGULAR_KEY/V3"){const{payload:E}=e;try{T({payload:E,parameter:EE,receivingMessage:"RECEIVE_SET_REGULAR_KEY/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_CREATE_OFFER/V3"){const{payload:E}=e;try{T({payload:E,parameter:eE,receivingMessage:"RECEIVE_CREATE_OFFER/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_CANCEL_OFFER/V3"){const{payload:E}=e;try{T({payload:E,parameter:rE,receivingMessage:"RECEIVE_CANCEL_OFFER/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SET_TRUSTLINE/V3"){const{payload:E}=e;try{T({payload:E,parameter:B,receivingMessage:"RECEIVE_SET_TRUSTLINE/V3",requestMessage:e.type,sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_ADD_TRUSTLINE"){const{payload:E}=e;try{T({payload:E,parameter:B,receivingMessage:"RECEIVE_TRUSTLINE_HASH",requestMessage:e.type,sender:r,errorPayload:{hash:void 0}})}catch(t){console.error(t)}}else if(a==="REQUEST_SIGN_ALICES_RING/V3"){const{payload:E}=e;try{T({payload:E,parameter:aE,receivingMessage:"RECEIVE_SIGN_ALICES_RING/V3",sender:r})}catch(t){console.log(t)}}else if(a==="REQUEST_SIGN_MESSAGE/V3"){const{payload:E}=e;try{T({payload:E,parameter:H,receivingMessage:"RECEIVE_SIGN_MESSAGE/V3",requestMessage:e.type,sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SIGN_MESSAGE"){const{payload:E}=e;try{T({payload:E,parameter:H,receivingMessage:"RECEIVE_SIGN_MESSAGE",requestMessage:e.type,sender:r,errorPayload:{signedMessage:void 0}})}catch(t){console.error(t)}}else if(a==="REQUEST_SUBMIT_TRANSACTION/V3"){const{payload:E}=e;try{T({payload:E,parameter:oE,receivingMessage:"RECEIVE_SUBMIT_TRANSACTION/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SIGN_TRANSACTION/V3"){const{payload:E}=e;try{T({payload:E,parameter:tE,receivingMessage:"RECEIVE_SIGN_TRANSACTION/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SET_HOOK/V3"){const{payload:E}=e;try{T({payload:E,parameter:_E,receivingMessage:"RECEIVE_SET_HOOK/V3",sender:r})}catch(t){console.error(t)}}else if(a==="REQUEST_SUBMIT_BULK_TRANSACTIONS/V3"){const{payload:E}=e;try{T({payload:E,parameter:sE,receivingMessage:"RECEIVE_SUBMIT_BULK_TRANSACTIONS/V3",sender:r})}catch(t){console.error(t)}}else if(a==="RECEIVE_SEND_PAYMENT/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SEND_PAYMENT/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_PAYMENT_HASH"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_PAYMENT_HASH",payload:{hash:E.hash}})}else if(a==="RECEIVE_MINT_NFT/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_MINT_NFT/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_CREATE_NFT_OFFER/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_CREATE_NFT_OFFER/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_CANCEL_NFT_OFFER/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_CANCEL_NFT_OFFER/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_ACCEPT_NFT_OFFER/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_ACCEPT_NFT_OFFER/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_BURN_NFT/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_BURN_NFT/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SET_ACCOUNT/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SET_ACCOUNT/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SET_REGULAR_KEY/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SET_REGULAR_KEY/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_CREATE_OFFER/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_CREATE_OFFER/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_CANCEL_OFFER/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_CANCEL_OFFER/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SET_TRUSTLINE/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SET_TRUSTLINE/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_TRUSTLINE_HASH"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_TRUSTLINE_HASH",payload:{hash:E.hash}})}else if(a==="RECEIVE_GET_ADDRESS/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_GET_ADDRESS/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_ADDRESS"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_ADDRESS",payload:{publicAddress:E.publicAddress}})}else if(a==="RECEIVE_GET_NETWORK/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_GET_NETWORK/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_NETWORK"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_NETWORK",payload:{network:E.network}})}else if(a==="RECEIVE_GET_PUBLIC_KEY/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_GET_PUBLIC_KEY/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_PUBLIC_KEY"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_PUBLIC_KEY",payload:{address:E.address,publicKey:E.publicKey}})}else if(a==="RECEIVE_GET_NFT/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_GET_NFT/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_NFT"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_NFT",payload:{nfts:E.nfts}})}else if(a==="RECEIVE_SIGN_ALICES_RING/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SIGN_ALICES_RING/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SIGN_MESSAGE/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SIGN_MESSAGE/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SIGN_MESSAGE"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SIGN_MESSAGE",payload:{signedMessage:E.signedMessage}})}else if(a==="RECEIVE_SUBMIT_TRANSACTION/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SUBMIT_TRANSACTION/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SIGN_TRANSACTION/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SIGN_TRANSACTION/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SET_HOOK/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SET_HOOK/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="RECEIVE_SUBMIT_BULK_TRANSACTIONS/V3"){const{payload:E}=e;_(E.id,{app:o,type:"RECEIVE_SUBMIT_BULK_TRANSACTIONS/V3",payload:{type:s.Response,result:E.result,error:E.error}})}else if(a==="EVENT_NETWORK_CHANGED"){const{payload:E}=e;C({app:o,type:"EVENT_NETWORK_CHANGED",source:"GEM_WALLET_MSG_REQUEST",payload:{result:E.result}})}else if(a==="EVENT_WALLET_CHANGED"){const{payload:E}=e;C({app:o,type:"EVENT_WALLET_CHANGED",source:"GEM_WALLET_MSG_REQUEST",payload:{result:E.result}})}else if(a==="EVENT_LOGIN"){const{payload:E}=e;C({app:o,type:"EVENT_LOGIN",source:"GEM_WALLET_MSG_REQUEST",payload:{result:E.result}})}}});chrome.windows.onRemoved.addListener(function(e){VE(e).then(r=>{if(r&&O){const o=IE(O);C(o)}})});const VE=async e=>{const{currentWindowId:r}=await chrome.storage.local.get(V);return e===r},NE=e=>{const{payload:r}=e;C({app:e.app,type:"EVENT_LOGOUT",source:"GEM_WALLET_MSG_REQUEST",payload:{result:r.result}})},f=new Set;chrome.runtime.onMessage.addListener((e,r)=>{var o;if(((o=r.tab)==null?void 0:o.id)!==void 0){if(e.type==="CONTENT_SCRIPT_LOADED")f.add(r.tab.id);else if(e.type==="CONTENT_SCRIPT_UNLOADED")try{f.delete(r.tab.id)}catch{console.error("Error while deleting tab")}}});const C=e=>{f.forEach(r=>{chrome.tabs.get(r,()=>{chrome.runtime.lastError||chrome.tabs.sendMessage(r,e)})})};
